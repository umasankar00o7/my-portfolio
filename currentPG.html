<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uma Sankar K - My AI & Data Science Journey</title>

  <!-- CDNs for Bootstrap & Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- CDN for Marked.js (Markdown Parser) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <!-- CDN for Highlight.js (Code Syntax Highlighting) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <style>
    /* --- FINAL VERSION: THEME & GLOBAL STYLES --- */
    :root {
      --primary-bg: #FDFEFF;
      --secondary-bg: #F0F4F8;
      --card-bg: #FFFFFF;
      --primary-text: #1A202C;
      --secondary-text: #4A5568;
      --accent-color: #087EA4;
      --accent-color-hover: #066482;
      --accent-color-light: rgba(8, 126, 164, 0.1);
      --border-color: #E2E8F0;
      --shadow-umbra: rgba(26, 32, 44, 0.08);
      --shadow-penumbra: rgba(26, 32, 44, 0.05);
      --success-color: #28a745;
      --warning-color: #fd7e14;
      --planned-color: #6c757d;
      --font-primary: 'Poppins', sans-serif;
      --font-secondary: 'Inter', sans-serif;
    }
    body { background-color: var(--primary-bg); font-family: var(--font-secondary); color: var(--primary-text); -webkit-font-smoothing: antialiased; }

    /* --- NAVBAR --- */
    .navbar { background: rgba(253, 254, 255, 0.9); backdrop-filter: blur(10px) saturate(180%); border-bottom: 1px solid var(--border-color); }
    .navbar-brand img { width: 42px; height: 42px; object-fit: cover; border-radius: 50%; border: 2px solid var(--accent-color-light); cursor: pointer; transition: transform 0.3s ease; }
    .navbar-brand img:hover { transform: scale(1.1); }
    .search-form-control { background-color: var(--secondary-bg); border: 1px solid var(--border-color); border-radius: 20px; padding-left: 1.5rem; transition: all 0.3s ease; }
    .search-form-control:focus { background-color: var(--card-bg); border-color: var(--accent-color); box-shadow: 0 0 0 3px var(--accent-color-light); }
    .btn-admin-action { background-color: var(--accent-color); color: white; font-weight: 500; }
    .btn-admin-action:hover { background-color: var(--accent-color-hover); color: white; }

    /* --- NEW: INTRO HEADER SECTION --- */
    .intro-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 2rem;
        margin-bottom: 3.5rem;
    }
    .intro-text h1 { font-weight: 700; }
    .intro-text p { color: var(--secondary-text); }
    .stat-card-mini {
        background-color: var(--card-bg);
        padding: 1rem;
        border-radius: 12px;
        text-align: center;
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 15px var(--shadow-penumbra);
        min-width: 160px;
    }
    .stat-number { font-family: var(--font-primary); font-size: 2.5rem; font-weight: 700; color: var(--accent-color); line-height: 1.1; }
    .stat-label { font-size: 0.9rem; color: var(--secondary-text); font-weight: 500; }

    /* ROADMAP TIMELINE */
    .roadmap-container { position: relative; padding: 20px 0; max-width: 1000px; margin: 0 auto; }
    .roadmap-container::before, .roadmap-container::after { content: ''; position: absolute; width: 4px; top: 0; left: 50%; margin-left: -2px; z-index: 0; border-radius: 2px; }
    .roadmap-container::before { background-color: var(--border-color); height: 100%; }
    .roadmap-container::after { background: linear-gradient(to bottom, var(--accent-color), var(--accent-color-hover)); height: var(--scroll-progress, 0%); transition: height 0.1s linear; }
    .roadmap-card { padding: 10px 40px; position: relative; width: 50%; display: flex; align-items: stretch; }
    @keyframes pulse-orange { 0% { box-shadow: 0 0 0 0 rgba(253, 126, 20, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(253, 126, 20, 0); } 100% { box-shadow: 0 0 0 0 rgba(253, 126, 20, 0); } }
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); } 100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); } }
    .roadmap-card::after { content: ''; position: absolute; width: 25px; height: 25px; background-color: var(--card-bg); border: 4px solid var(--planned-color); top: 30px; border-radius: 50%; z-index: 1; transition: all 0.3s ease; }
    .roadmap-card.status-completed::after { border-color: var(--success-color); animation: pulse-green 2s infinite; }
    .roadmap-card.status-in-progress::after { border-color: var(--warning-color); animation: pulse-orange 2s infinite; }
    .roadmap-card:hover::after { transform: scale(1.2); }
    .roadmap-card.left { left: 0; }
    .roadmap-card.right { left: 50%; }
    .roadmap-card.left::after { right: -12.5px; }
    .roadmap-card.right::after { left: -12.5px; }
    .roadmap-card.left::before { content: " "; height: 0; position: absolute; top: 37px; width: 0; z-index: 1; right: 30px; border: 10px solid transparent; border-left-color: var(--border-color); }
    .roadmap-card.right::before { content: " "; height: 0; position: absolute; top: 37px; width: 0; z-index: 1; left: 30px; border: 10px solid transparent; border-right-color: var(--border-color); }
    .roadmap-content { padding: 20px 25px; background-color: var(--card-bg); position: relative; overflow: hidden; border-radius: 8px; border: 1px solid var(--border-color); box-shadow: 0 5px 15px var(--shadow-penumbra); transition: all 0.3s ease; cursor: pointer; width: 100%; display: flex; flex-direction: column; }
    .card-content-wrapper { flex-grow: 1; }
    .card-header-wrapper { position: relative; padding-right: 90px; }
    .status-badge { position: absolute; top: 0; right: 0; font-size: 0.75rem; font-weight: 600; padding: 0.3em 0.7em; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.5px; color: white; }
    .status-badge.completed { background-color: var(--success-color); }
    .status-badge.in-progress { background-color: var(--warning-color); }
    .status-badge.planned { background-color: var(--planned-color); }
    .confidence-gauge { height: 8px; border-radius: 4px; background-color: var(--secondary-bg); overflow: hidden; margin-top: auto; }
    .confidence-gauge-bar { height: 100%; border-radius: 4px; background: linear-gradient(90deg, var(--warning-color), var(--success-color)); transition: width 1s ease; }
    @keyframes floatAnimation { 0% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-8px) rotate(-1deg); } 100% { transform: translateY(0) rotate(0); } }
    .roadmap-content { animation: floatAnimation 4s ease-in-out infinite alternate; }
    .roadmap-card.right .roadmap-content { animation-duration: 5s; }
    .roadmap-content:hover { animation-play-state: paused; transform: translateY(-5px); box-shadow: 0 8px 25px var(--shadow-umbra); }

    /* MOBILE VIEW */
    @media screen and (max-width: 768px) {
      .intro-header { flex-direction: column; text-align: center; gap: 0.5rem; margin-bottom: 2.5rem; }
      .stat-card-mini { margin: 1.5rem auto 0 auto; }
      .roadmap-container::after { left: 31px; }
      .roadmap-card { width: 100%; padding-left: 70px; padding-right: 25px; }
      .roadmap-card.right { left: 0%; }
      .roadmap-card.left::after, .roadmap-card.right::after { left: 18px; }
      .roadmap-card.left::before, .roadmap-card.right::before { left: 60px; right: auto; border-width: 8px 8px 8px 0; border-color: transparent var(--border-color) transparent transparent; }
    }

    /* FLOATING ACTION BUTTON (MOBILE ONLY) */
    #addEntryFab { position: fixed; bottom: 25px; right: 25px; width: 56px; height: 56px; border-radius: 50%; background-color: var(--accent-color); color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1030; transition: transform 0.3s ease; }
    #addEntryFab:hover { transform: scale(1.05); background-color: var(--accent-color-hover); }
    
    /* MODAL STYLES */
    .modal-section { border-bottom: 1px solid var(--border-color); padding-bottom: 1.25rem; margin-bottom: 1.25rem; }
    .modal-section:last-child { border-bottom: none; }
    .modal-section-title { font-size: 0.9rem; font-weight: 600; text-transform: uppercase; color: var(--secondary-text); margin-bottom: 0.75rem; }
    #detail-keyTakeaway-container blockquote { background-color: var(--accent-color-light); border-left: 4px solid var(--accent-color); padding: 1rem 1.5rem; margin: 0; font-style: italic; }
    #detail-content-output pre { position: relative; }
    #detail-content-output pre code.hljs { border-radius: 8px; padding: 1.5rem 1rem 1rem 1rem; }
    .copy-code-button { position: absolute; top: 8px; right: 8px; background-color: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; padding: 0.25rem 0.6rem; font-size: 0.8rem; cursor: pointer; transition: background-color 0.2s; }
    .copy-code-button.copied { background-color: var(--success-color); }
    .challenge-spotlight summary { cursor: pointer; font-weight: 600; color: var(--accent-color); }
    .page-loader { border: 5px solid var(--secondary-bg); border-top: 5px solid var(--accent-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 50px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>

<body>
  <!-- HTML STRUCTURE (with new intro panel) -->
  <nav class="navbar navbar-expand-lg sticky-top"><div class="container"><a class="navbar-brand d-flex align-items-center" href="#"><img src="https://res.cloudinary.com/dljmxltfr/image/upload/v1748052241/IMG_20250521_104303968_HDR_acl4am.jpg" alt="Uma Sankar K" data-bs-toggle="modal" data-bs-target="#profileImageModal"><span class="ms-2 fw-bold">AI Journey</span></a><div class="d-flex align-items-center w-100 w-lg-auto"><form class="d-flex w-100 me-3 me-lg-3" role="search"><input id="searchInput" class="form-control form-control-sm search-form-control" type="search" placeholder="Search my journey..." aria-label="Search"></form><button id="addEntryBtn" class="btn btn-sm btn-admin-action rounded-pill d-none d-lg-block flex-shrink-0"><i class="fas fa-plus me-1"></i> Add Entry</button></div></div></nav>
  
  <main class="container py-5">
    <!-- NEW: INTRO DASHBOARD -->
    <div class="intro-header">
      <div class="intro-text">
        <h1 class="display-5">My Data Science & AI Roadmap</h1>
        <p class="lead text-muted mb-0">A real-time log of my learning, challenges, and breakthroughs.</p>
      </div>
      <div class="stat-card-mini">
        <div class="stat-number" id="totalWeeksStat">0</div>
        <div class="stat-label">Weeks Logged</div>
      </div>
    </div>
    
    <div id="roadmap-container"><div id="pageLoader" class="page-loader"></div></div>
  </main>

  <footer class="py-4 mt-5 bg-light text-center"><p class="mb-0 text-muted">© <span id="currentYear"></span> Uma Sankar K. All rights reserved.</p></footer>
  
  <!-- NEW: Floating Action Button for mobile -->
  <button id="addEntryFab" class="btn btn-lg d-lg-none"><i class="fas fa-plus"></i></button>

  <!-- Modals (no structural changes needed) -->
  <div class="modal fade" id="entryDetailModal" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="detail-title"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="modal-section" id="detail-confidence-container"><div class="d-flex justify-content-between align-items-center mb-1"><span class="modal-section-title mb-0">CONFIDENCE</span><span id="detail-confidence-text" class="fw-bold small text-accent">0%</span></div><div id="detail-confidence-gauge" class="progress"><div id="detail-confidence-bar" class="progress-bar"></div></div></div><div class="modal-section" id="detail-keyTakeaway-container"><h6 class="modal-section-title">KEY TAKEAWAY</h6><blockquote id="detail-keyTakeaway-text"></blockquote></div><div class="modal-section" id="detail-content-container"><h6 class="modal-section-title">DETAILED LOG</h6><div id="detail-content-output"></div></div><div class="modal-section" id="detail-challenge-container"><h6 class="modal-section-title">CHALLENGE & SOLUTION</h6><div class="p-3 bg-light rounded"><p class="mb-2"><strong>Problem:</strong> <span id="detail-challenge-problem"></span></p><details class="challenge-spotlight"><summary>Reveal My Solution</summary><p class="mt-2" id="detail-challenge-solution"></p></details></div></div><div class="modal-section" id="detail-resources-container"><h6 class="modal-section-title">LEARNING ARSENAL</h6><div id="detail-resources-list"></div></div><div class="modal-section" id="detail-technologies-container"><h6 class="modal-section-title">TECHNOLOGIES</h6><div id="detail-tech-stack"></div></div><a href="#" id="detail-project-link" target="_blank" class="btn btn-dark w-100 d-none"><i class="fab fa-github me-2"></i> View Project</a></div><div class="modal-footer justify-content-start"><button id="editEntryBtn" class="btn btn-sm btn-outline-primary"><i class="fas fa-edit me-1"></i> Edit</button><button id="deleteEntryBtn" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash me-1"></i> Delete</button></div></div></div></div>
  <div class="modal fade" id="adminModal" tabindex="-1" data-bs-backdrop="static"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><form id="adminForm"><div class="modal-header"><h5 class="modal-title" id="adminModalTitle">Add New Journey Entry</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="admin-doc-id"><div class="row g-3"><div class="col-md-3"><label for="admin-weekNumber" class="form-label">Week Number*</label><input type="number" class="form-control" id="admin-weekNumber" required></div><div class="col-md-9"><label for="admin-title" class="form-label">Title*</label><input type="text" class="form-control" id="admin-title" required></div><div class="col-12"><label for="admin-summary" class="form-label">Summary*</label><input type="text" class="form-control" id="admin-summary" required></div><div class="col-12"><div class="d-flex justify-content-between align-items-center mb-1"><label for="admin-content" class="form-label">Detailed Content (Markdown)</label><button type="button" id="addCodeSnippetBtn" class="btn btn-sm btn-outline-secondary"><i class="fas fa-code me-1"></i> Add Code Block</button></div><textarea class="form-control" id="admin-content" rows="6"></textarea></div><div class="col-md-6"><label for="admin-technologies" class="form-label">Technologies (comma-separated)</label><input type="text" class="form-control" id="admin-technologies" placeholder="Python, Pandas, NumPy"></div><div class="col-md-3"><label for="admin-status" class="form-label">Status*</label><select id="admin-status" class="form-select" required><option value="Completed" selected>Completed</option><option value="In Progress">In Progress</option><option value="Planned">Planned</option></select></div><div class="col-md-3"><label for="admin-confidenceLevel" class="form-label">Confidence (0-100)</label><input type="number" class="form-control" id="admin-confidenceLevel" min="0" max="100"></div><div class="col-12"><label for="admin-keyTakeaway" class="form-label">Key Takeaway</label><input type="text" class="form-control" id="admin-keyTakeaway"></div><div class="col-md-6"><label for="admin-challenge-problem" class="form-label">Challenge Problem</label><input type="text" class="form-control" id="admin-challenge-problem"></div><div class="col-md-6"><label for="admin-challenge-solution" class="form-label">Challenge Solution</label><input type="text" class="form-control" id="admin-challenge-solution"></div><div class="col-12"><label for="admin-projectLink" class="form-label">Project Link (URL)</label><input type="url" class="form-control" id="admin-projectLink"></div><div class="col-12"><label for="admin-resources" class="form-label">Resources (JSON format)</label><textarea class="form-control" id="admin-resources" rows="3" placeholder='[{"name":"Pandas Docs","type":"Docs","url":"..."}]'></textarea></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary" id="saveEntryBtn">Save Entry</button></div></form></div></div></div>
  <div class="modal fade" id="passwordModal" tabindex="-1" data-bs-backdrop="static"> <div class="modal-dialog modal-sm modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Admin Access Required</h5><button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button></div><div class="modal-body"><p class="text-muted small">Enter the password to manage entries.</p><input type="password" id="passwordInput" class="form-control"><div id="passwordError" class="text-danger small mt-2 d-none">Incorrect password.</div></div><div class="modal-footer"><button type="button" class="btn btn-primary" id="passwordSubmitBtn">Login</button></div></div></div></div>
  <div class="modal fade" id="profileImageModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content bg-transparent border-0"><div class="modal-body text-center p-0"><img src="https://res.cloudinary.com/dljmxltfr/image/upload/v1748052241/IMG_20250521_104303968_HDR_acl4am.jpg" class="img-fluid rounded" alt="Uma Sankar K - Full View" style="max-height: 90vh;"></div></div></div></div>
  <div class="toast-container position-fixed bottom-0 end-0 p-3"><div id="appToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true"><div class="toast-header"><strong class="me-auto" id="toastTitle">Notification</strong><button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button></div><div class="toast-body" id="toastBody"></div></div></div>

  <!-- JS Libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function() {
      // --- CONFIG & INIT ---
      const ADMIN_PASSWORD = "data_journey_2024";
      const COLLECTION_NAME = "journeyEntries";
      const firebaseConfig = {
        apiKey: "AIzaSyCNl8-WXGhHeGjmDl-6ma2bFxc1kIiGOLA",
        authDomain: "datascience-roadmap.firebaseapp.com",
        projectId: "datascience-roadmap",
        storageBucket: "datascience-roadmap.firebasestorage.app",
        messagingSenderId: "111702575874",
        appId: "1:111702575874:web:9776fbf678d30a29d4d01b"
      };
      let db;
      try { firebase.initializeApp(firebaseConfig); db = firebase.firestore(); } 
      catch (e) { console.error(e); showToast("Error", "DB connection failed.", "danger"); return; }
      document.getElementById("currentYear").textContent = new Date().getFullYear();

      // --- STATE & DOM ---
      let allEntries = [];
      const ADMIN_SESSION_KEY = "ai_journey_admin_session_v2";
      const pageLoader = document.getElementById('pageLoader'); 
      const roadmapContainer = document.getElementById('roadmap-container');
      const adminModal = new bootstrap.Modal(document.getElementById('adminModal'));
      const detailModal = new bootstrap.Modal(document.getElementById('entryDetailModal'));
      const passwordModal = new bootstrap.Modal(document.getElementById('passwordModal'));
      const appToast = new bootstrap.Toast(document.getElementById('appToast'));

      // --- CORE FUNCTIONS ---
      async function fetchAndRenderEntries() {
        pageLoader.style.display = 'block';
        roadmapContainer.innerHTML = ''; 
        try {
          const snapshot = await db.collection(COLLECTION_NAME).orderBy("weekNumber", "asc").get();
          allEntries = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          renderRoadmap(allEntries);
          updateDashboardStats();
        } catch (e) {
          showToast("Error", "Could not fetch entries. Check Firestore rules.", "danger");
        } finally {
          pageLoader.style.display = 'none';
        }
      }
      
      function renderRoadmap(entries) {
          roadmapContainer.innerHTML = '';
          if (entries.length === 0) {
              roadmapContainer.innerHTML = '<p class="text-center text-muted">No entries found.</p>';
              return;
          }
          entries.forEach((entry, index) => {
              const side = index % 2 === 0 ? 'left' : 'right';
              const statusClass = entry.status ? `status-${entry.status.toLowerCase().replace(' ', '-')}` : 'status-planned';
              const cardHTML = `
                  <div class="roadmap-card ${side} ${statusClass}" data-id="${entry.id}">
                      <div class="roadmap-content">
                          <div class="card-content-wrapper">
                              <div class="card-header-wrapper">
                                <span class="status-badge ${statusClass}">${entry.status || 'Planned'}</span>
                                <h4 class="fw-bold">${entry.title}</h4>
                              </div>
                              <p class="text-muted small mb-2">Week ${entry.weekNumber}</p>
                              <p class="mb-3">${entry.summary}</p>
                          </div>
                          <div class="confidence-gauge">
                              <div class="confidence-gauge-bar" style="width: ${entry.confidenceLevel || 0}%"></div>
                          </div>
                      </div>
                  </div>
              `;
              roadmapContainer.insertAdjacentHTML('beforeend', cardHTML);
          });
          addSpotlightEffect();
      }
      
      function showDetailModal(entryId) {
          const entry = allEntries.find(e => e.id === entryId);
          if (!entry) return;
          document.getElementById('detail-title').textContent = entry.title;
          
          const updateSection = (containerId, content, renderFn) => {
              const container = document.getElementById(containerId);
              const exists = content && (content.length > 0 || (typeof content === 'number' && content >= 0));
              container.style.display = exists ? 'block' : 'none';
              if (exists) renderFn(content);
          };

          updateSection('detail-confidence-container', entry.confidenceLevel, level => {
              document.getElementById('detail-confidence-text').textContent = `${level}%`;
              const bar = document.getElementById('detail-confidence-bar');
              bar.style.width = '0%';
              setTimeout(() => bar.style.width = `${level}%`, 100);
          });
          updateSection('detail-keyTakeaway-container', entry.keyTakeaway, text => {
              document.getElementById('detail-keyTakeaway-text').textContent = text;
          });
          updateSection('detail-content-container', entry.content, text => {
              const outputEl = document.getElementById('detail-content-output');
              outputEl.innerHTML = marked.parse(text);
              outputEl.querySelectorAll('pre code').forEach(hljs.highlightElement);
              addCopyButtons(outputEl);
          });
          updateSection('detail-challenge-container', entry.challenge?.problem, () => {
              document.getElementById('detail-challenge-problem').textContent = entry.challenge.problem;
              document.getElementById('detail-challenge-solution').textContent = entry.challenge.solution || 'No solution provided.';
          });
          updateSection('detail-resources-container', entry.resources, resources => {
              document.getElementById('detail-resources-list').innerHTML = resources.map(res => {
                  const icon = { Course: 'fa-graduation-cap', Video: 'fa-video', Docs: 'fa-book', Article: 'fa-newspaper' }[res.type] || 'fa-link';
                  return `<a href="${res.url}" target="_blank" class="resource-link"><i class="fas ${icon} me-2 text-muted"></i>${res.name}</a>`;
              }).join('');
          });
          updateSection('detail-technologies-container', entry.technologies, technologies => {
              document.getElementById('detail-tech-stack').innerHTML = technologies.map(tech => `<span class="badge bg-light text-dark border me-1 mb-1">${tech}</span>`).join('');
          });
          
          const projectLink = document.getElementById('detail-project-link');
          if (entry.projectLink) { projectLink.href = entry.projectLink; projectLink.classList.remove('d-none'); } 
          else { projectLink.classList.add('d-none'); }

          document.getElementById('editEntryBtn').dataset.id = entry.id;
          document.getElementById('deleteEntryBtn').dataset.id = entry.id;
          detailModal.show();
      }

      function addCopyButtons(container) {
          container.querySelectorAll('pre').forEach(pre => {
              if(pre.querySelector('.copy-code-button')) return;
              const button = document.createElement('button');
              button.className = 'copy-code-button';
              button.innerHTML = '<i class="far fa-copy"></i> Copy';
              pre.appendChild(button);
              button.addEventListener('click', () => {
                  const code = pre.querySelector('code').innerText;
                  navigator.clipboard.writeText(code).then(() => {
                      button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                      button.classList.add('copied');
                      setTimeout(() => {
                          button.innerHTML = '<i class="far fa-copy"></i> Copy';
                          button.classList.remove('copied');
                      }, 2000);
                  });
              });
          });
      }
      
      // Admin logic is unchanged and correct
      function openAdminModal(entryId=null){const e=document.getElementById("adminForm");e.reset(),document.getElementById("admin-doc-id").value="",entryId?(()=>{const t=allEntries.find(e=>e.id===entryId);t&&(document.getElementById("adminModalTitle").textContent="Edit Journey Entry",document.getElementById("admin-doc-id").value=t.id,document.getElementById("admin-weekNumber").value=t.weekNumber,document.getElementById("admin-title").value=t.title,document.getElementById("admin-summary").value=t.summary,document.getElementById("admin-content").value=t.content||"",document.getElementById("admin-technologies").value=(t.technologies||[]).join(", "),document.getElementById("admin-status").value=t.status,document.getElementById("admin-confidenceLevel").value=t.confidenceLevel,document.getElementById("admin-keyTakeaway").value=t.keyTakeaway||"",document.getElementById("admin-challenge-problem").value=t.challenge?.problem||"",document.getElementById("admin-challenge-solution").value=t.challenge?.solution||"",document.getElementById("admin-projectLink").value=t.projectLink||"",document.getElementById("admin-resources").value=t.resources?JSON.stringify(t.resources,null,2):"[]")})():document.getElementById("adminModalTitle").textContent="Add New Journey Entry",adminModal.show()}async function handleSaveEntry(e){e.preventDefault();const t=document.getElementById("saveEntryBtn");t.disabled=!0,t.textContent="Saving...";let o=[];try{const n=document.getElementById("admin-resources").value.trim();n&&(o=JSON.parse(n))}catch(r){return showToast("Error","Resources JSON is not valid.","danger"),void(t.disabled=!1,t.textContent="Save Entry")}const n={weekNumber:Number(document.getElementById("admin-weekNumber").value),title:document.getElementById("admin-title").value,summary:document.getElementById("admin-summary").value,content:document.getElementById("admin-content").value,technologies:document.getElementById("admin-technologies").value.split(",").map(e=>e.trim()).filter(Boolean),status:document.getElementById("admin-status").value,confidenceLevel:Number(document.getElementById("admin-confidenceLevel").value),keyTakeaway:document.getElementById("admin-keyTakeaway").value,challenge:{problem:document.getElementById("admin-challenge-problem").value,solution:document.getElementById("admin-challenge-solution").value},projectLink:document.getElementById("admin-projectLink").value,resources:o,timestamp:firebase.firestore.FieldValue.serverTimestamp()},d=document.getElementById("admin-doc-id").value;try{d?await db.collection("journeyEntries").doc(d).set(n,{merge:!0}):await db.collection("journeyEntries").add(n),showToast("Success",d?"Entry updated!":"Entry added!","success"),adminModal.hide(),fetchAndRenderEntries()}catch(i){showToast("Error","Could not save. Check Firestore rules.","danger")}finally{t.disabled=!1,t.textContent="Save Entry"}}async function handleDeleteEntry(e){if(!confirm("Are you sure you want to delete this entry?"))return;try{await db.collection("journeyEntries").doc(e).delete(),showToast("Success","Entry deleted.","success"),detailModal.hide(),fetchAndRenderEntries()}catch(t){showToast("Error","Could not delete. Check Firestore rules.","danger")}}
      function ensureAdminAccess(){return"true"===sessionStorage.getItem(ADMIN_SESSION_KEY)?Promise.resolve(!0):(passwordModal.show(),new Promise(e=>{const t=document.getElementById("passwordSubmitBtn"),o=document.getElementById("passwordInput");const n=()=>{const d=document.getElementById("passwordError");"data_journey_2024"===o.value?(sessionStorage.setItem(ADMIN_SESSION_KEY,"true"),passwordModal.hide(),o.value="",d.classList.add("d-none"),e(!0)):(d.classList.remove("d-none"),e(!1))};t.onclick=n,o.onkeypress=t=>{"Enter"===t.key&&n()}}))}
      function addSpotlightEffect(){document.querySelectorAll(".roadmap-content").forEach(e=>e.addEventListener("mousemove",t=>{const o=e.getBoundingClientRect(),n=t.clientX-o.left,d=t.clientY-o.top;e.style.setProperty("--mouse-x",`${n}px`),e.style.setProperty("--mouse-y",`${d}px`)}))}
      function showToast(e,t,o="info"){const n=document.querySelector("#appToast .toast-header");document.getElementById("toastTitle").textContent=e,document.getElementById("toastBody").textContent=t,n.className="toast-header";const d={success:"bg-success text-white",danger:"bg-danger text-white",warning:"bg-warning text-dark",info:"bg-info text-dark"};d[o]&&n.classList.add(...d[o].split(" ")),appToast.show()}
      
      // --- NEW: Dashboard & Scroll Logic ---
      function updateDashboardStats() {
          const totalWeeks = allEntries.length;
          animateNumber(document.getElementById('totalWeeksStat'), totalWeeks);
      }
      
      function animateNumber(element, finalValue) {
          if (!element) return;
          let start = 0;
          const duration = 1000;
          if (finalValue === 0) { element.textContent = 0; return; }
          const stepTime = Math.abs(Math.floor(duration / finalValue));
          const timer = setInterval(() => {
              start += 1;
              element.textContent = start;
              if (start >= finalValue) clearInterval(timer);
          }, stepTime);
      }
      
      function updateScrollProgress() {
          const container = document.querySelector('.roadmap-container');
          if(!container) return;
          const scrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
          const progress = Math.min(100, (window.scrollY / scrollableHeight) * 100);
          container.style.setProperty('--scroll-progress', `${progress}%`);
      }

      // --- EVENT LISTENERS ---
      document.addEventListener('DOMContentLoaded', fetchAndRenderEntries);
      window.addEventListener('scroll', updateScrollProgress);
      document.getElementById('addEntryBtn').addEventListener('click', async () => { if (await ensureAdminAccess()) openAdminModal(); });
      document.getElementById('addEntryFab').addEventListener('click', async () => { if (await ensureAdminAccess()) openAdminModal(); });
      document.getElementById('adminForm').addEventListener('submit', handleSaveEntry);
      roadmapContainer.addEventListener('click', e => { const card = e.target.closest('.roadmap-card'); if (card?.dataset.id) showDetailModal(card.dataset.id); });
      document.getElementById('searchInput').addEventListener('input', e => {
          const term = e.target.value.toLowerCase();
          const filtered = allEntries.filter(entry => entry.title.toLowerCase().includes(term) || entry.summary.toLowerCase().includes(term) || (entry.technologies || []).some(tech => tech.toLowerCase().includes(term)) || (entry.content || '').toLowerCase().includes(term) || `week ${entry.weekNumber}`.includes(term));
          renderRoadmap(filtered);
      });
      document.getElementById('editEntryBtn').addEventListener('click', async e => { if (await ensureAdminAccess()) { detailModal.hide(); openAdminModal(e.target.dataset.id); } });
      document.getElementById('deleteEntryBtn').addEventListener('click', async e => { if (await ensureAdminAccess()) handleDeleteEntry(e.target.dataset.id); });
      document.getElementById('addCodeSnippetBtn').addEventListener('click', () => {
          const textarea = document.getElementById('admin-content');
          const language = prompt("Enter language for code block (e.g., python, java, js):", "python");
          if (language) {
              const snippet = `\n\`\`\`${language}\n\n\`\`\`\n`;
              textarea.value += snippet;
              textarea.focus();
              textarea.selectionStart = textarea.value.length - 4;
          }
      });

    })();
  </script>

</body>
</html>